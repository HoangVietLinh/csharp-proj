<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<img src="page-loader.gif" id="loader" style="position: absolute;top: 160px;left: 500;">
<img src="../goes_east_tatl_img/2015302_0015rb.jpg" id="map">
<br>
<div>
<input type="button" id="back" value="<<" style="width: 40px;">
<input type="range" id="speed" value="50" style="width: 600px;position:relative;top:6px">
<input type="button" id="forw" value=">>" style="width: 40px;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="text" id="count" value="40" style="width: 40px; text-align: center;">
</div>
<div id="images" style="display:none"></div>

<script>
var count = 1
var paused = false;
var images = ["2015302_0015rb.jpg", "2015302_0045rb.jpg", "2015302_0115rb.jpg", "2015302_0145rb.jpg"];
addAllImages()

$(window).ready(function() { setTimeout(changeImage, 500); });
$(window).load(function(){
    $("#speed").click(function () { paused = false; changeImage(); });
    $("#back").click(function () { changePos(-2); });
    $("#forw").click(function () { changePos(2); });
    $("#count").change(changeCount);
    $("#loader").fadeOut("slow");
	$("#speed").val(10)	
	count = 0;
	getImages(40);
});

function changeCount() {
    var strCount = $("#count").val();
    var intCount = 40
    if ($.isNumeric(strCount)) {
        intCount = parseInt(strCount);
    } else {
        $("#count").val(intCount);
    }
    getImages(intCount);
}

function getImages(count) {
    $("#loader").show();
    $.ajax({
        type: "GET",
        url: "/api/Images/EastAtlantic?count=" + count,
        cache: false,
        success: successFunc,
        error: errorFunc,
    });
}

function successFunc(data) {
    images = data;
    images.reverse();
    addAllImages();
    $("#loader").fadeOut("slow");
}

function errorFunc(err) {
    if (err.responseText == "")
        alert("Sorry the communication failed.");
    else
	    alert(err.responseText);
}

function changePos(pos){
	count += pos;
	if (count < 0) 
		count = images.length-2;
	paused = true;
	$("#speed").val(50);
	changeImage();
}

function changeImage(){
	$("#map").attr("src","../goes_east_tatl_img/" + images[count] );
	count += 1
	if (count >= images.length)
		count = 0
	if (!paused)
		setTimeout(changeImage, $("#speed").val()*10);
}

function addAllImages(){
	for (i = 0; i < images.length; i++) {
		$("#images").append('<img src="../goes_east_tatl_img/' + images[i] + '">');
	}
}
</script>